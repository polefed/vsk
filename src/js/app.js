// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================

import * as flsFunctions from './modules/functions.js';

flsFunctions.isWebp();


import './swiper.min.js';
// import './cart-1.js';

// window.onload = () => {}
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// webp
// function testWebP(callback) {

//     var webP = new Image();
//     webP.onload = webP.onerror = function () {
//         callback(webP.height == 2);
//     };
//     webP.src = "data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA";
// }

// testWebP(function (support) {

//     if (support == true) {
//         document.querySelector('body').classList.add('webp');
//     } else {
//         document.querySelector('body').classList.add('no-webp');
//     }
// });
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================

// scroll up + circular indicator

const scrollUpOffset = 100;
const scrollUp = document.querySelector('.scroll-up');
const scrollUpSvgPath = document.querySelector('.scroll-up__svg-path');
const scrollUpPathLength = scrollUpSvgPath.getTotalLength();

scrollUpSvgPath.style.strokeDasharray = `${scrollUpPathLength} ${scrollUpPathLength}`;
scrollUpSvgPath.style.transition = 'stroke-dashoffset 20ms';

const getTop = () => window.pageYOffset || document.documentElement.scrollTop;

const updateDashoffset = () => {
    const scrollUpHeight = document.documentElement.scrollHeight - window.innerHeight;
    const scrollUpDashoffset = scrollUpPathLength - (getTop() * scrollUpPathLength / scrollUpHeight);

    scrollUpSvgPath.style.strokeDashoffset = scrollUpDashoffset;
};

window.addEventListener('scroll', () => {
    updateDashoffset();
    if (getTop() > scrollUpOffset) {
        scrollUp.classList.add('__active');
    } else {
        scrollUp.classList.remove('__active');
    }
});

scrollUp.addEventListener('click', () => {
    window.scrollTo({
        top: 0,
        behavior: 'smooth',
    });
});

// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// progress bar
// var progressBar = document.querySelector('.progress-bar');
// window.onscroll = function (e) {
//     var progressBarHeight = document.body.offsetHeight - window.innerHeight;
//     var progressBarWidth = (window.pageYOffset * 105 / progressBarHeight)
//     progressBar.style.width = progressBarWidth + '%'
// }
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================



// main-slider 

const mainSwiper = new Swiper('.main-slider .swiper-container', {
    slidesPerView: 1,
    slidesPerGroup: 1,
    // spaceBetween: 30,
    speed: 600,
    loop: true,
    autoHeight: false,
    preloadImages: true,
    autoplay: {
        delay: 3000,
        disableOnInteraction: false,
    },
    // breakpoints: {
    //     992: {
    //       autoHeight: false,
    //     },
    //   },
    parallax: true,
    pagination: {
        el: '.main-slider__pagination',
        type: 'bullets',
        clickable: true,},
});

const sliderToggleStop = document.querySelector('.slider-toggle__stop');
sliderToggleStop.addEventListener('click', () => {
    mainSwiper.autoplay.stop();
});
const sliderTogglePlay = document.querySelector('.slider-toggle__play');
sliderTogglePlay.addEventListener('click', () => {
    mainSwiper.autoplay.start();
});

// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
const bodyStyles = window.getComputedStyle(document.body);
const sliderSlidesPerView = parseInt(bodyStyles.getPropertyValue('--sliderSlidesPerView'));
// seconady-slider 
const secondarySwiper = new Swiper('.secondary-slider .swiper-container', {
    navigation: {
        nextEl: '.secondary-slider__button-next',
        prevEl: '.secondary-slider__button-prev',},
    slidesPerView: sliderSlidesPerView,
    slidesPerGroup: 1,
    spaceBetween: 20,
    // autoHeight: true,
    // speed: 1000,
    loop: true,
    parallax: true,
});

// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// custom slider
// let positionCS = 0;
// const slidesToShowCS = 3;
// const slidesToScrollCS = 1;
// const containerCS = document.querySelector('.top-slider__container');
// const trackCS = document.querySelector('.top-slider__track');
// const btnPrevCS = document.querySelector('.top-slider__navigation-prev');
// const btnNextCS = document.querySelector('.top-slider__navigation-next');
// const itemsCS = document.querySelectorAll('.top-slider__item');
// const itemsCountCS = itemsCS.length;
// const itemWidthCS = containerCS.clientWidth / slidesToShowCS;
// const movePositionCS = slidesToScrollCS * itemWidthCS;
// itemsCS.forEach((item) => {
//     item.style.minWidth = `${itemWidthCS}px`;
// });
// btnNextCS.addEventListener('click', () => {
//     const itemsLeft = itemsCountCS - (Math.abs(positionCS) + slidesToShowCS * itemWidthCS) / itemWidthCS;
//     positionCS -= itemsLeft >= slidesToScrollCS ? movePositionCS : itemsLeft * itemWidthCS;
//     setPosition();
//     checkBtns();
// });
// btnPrevCS.addEventListener('click', () => {
//     const itemsLeft = Math.abs(positionCS) / itemWidthCS;
//     positionCS += itemsLeft >= slidesToScrollCS ? movePositionCS : itemsLeft * itemWidthCS;
//     setPosition();
//     checkBtns();
// });
// const setPosition = () => {
//     trackCS.style.transform = `translateX(${positionCS}px)`;
// };
// const checkBtns = () => {
//     btnPrevCS.disabled = positionCS === 0;
//     btnNextCS.disabled = positionCS <= -(itemsCountCS - slidesToShowCS) * itemWidthCS;
// };
// checkBtns();
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// animate on scroll 
// const showItem = document.querySelectorAll('.show-item');
// const showOptions = {
//     root: null,
//     rootMargin: '0px',
//     threshold: .1
// }
// const showCallback = (entries) => {
//     entries.forEach(entry => {
//         if (entry.isIntersecting) {
//             entry.target.classList.add('__show')
//         }
//     })  
// }
// let showObserver = new IntersectionObserver(showCallback, showOptions);
// showItem.forEach(el => {
//     showObserver.observe(el);
// });
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================

// lazy load & Animate on scroll

const lazyImages = document.querySelectorAll('[data-src]');
const showItems = document.querySelectorAll('.show-item');

const showLazyOptions = {
    root: null,
    rootMargin: '200px',
    threshold: .1
}

const showLazyCallback = (entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            let lazyImage = entry.target;
            lazyImage.src = lazyImage.dataset.src;
            showLazyObserver.unobserve(lazyImage);
            entry.target.classList.add('__show')
        }
    })
};

let showLazyObserver = new IntersectionObserver(showLazyCallback, showLazyOptions);

lazyImages.forEach(el => {
    showLazyObserver.observe(el);
});

showItems.forEach(el => {
    showLazyObserver.observe(el);
});

// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================


// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// add & remove class + closest
// const mainIcon = document.querySelector('.search__icon');
// const mainMenu = document.querySelector('.search__block');
// mainIcon.addEventListener("click", function(e) {
//     mainMenu.classList.toggle('__active')
// });
// document.documentElement.addEventListener("click", function(e) {
//     if (!e.target.closest('.search')) {
//         mainMenu.classList.remove('__active');
//     }
// });
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// rating
// const mainRatingItem = document.querySelectorAll('.main-rating__item');
// const mainRatingItemArray = Array.prototype.slice.call(mainRatingItem);

// mainRatingItemArray.forEach(item =>
//     item.addEventListener('click', () => {
//         const { itemValue } = item.dataset;
//         item.parentNode.dataset.rating = item.dataset.ratingItem;
//     })
// );

// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================

// show header on scroll to top

// let lastScroll = 0;
// const header = document.querySelector('.header-bottom');
// const scrollPosition = () => window.pageYOffset || document.documentElement.scrollTop;
// const containHide = () => header.classList.contains('__hide');
// window.addEventListener('scroll', () => {
//     if(scrollPosition() > lastScroll && !containHide()) {
//         header.classList.add('__hide');
//     }
//     else if(scrollPosition() < lastScroll && containHide()){
//         header.classList.remove('__hide');
//     }
//     lastScroll = scrollPosition();
// })

// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================

// change header class on scroll

// window.addEventListener('scroll', function(){
//     const myHeader = document.querySelector('.header-bottom');
//     myHeader.classList.toggle('__scrolled', window.scrollY > 80)
// })

// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================

// dynamic header ( header height = header-padding)

// window.addEventListener('load', headerSize, false);
// window.addEventListener('resize', headerSize, false);
// function headerSize(){
//     headerHeight = document.querySelector(".header-bottom").clientHeight;
//     headerPadding = document.querySelector(".header-padding");
//     headerPadding.style.paddingTop = headerHeight + "px";
// };

// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================

// toggle buttons

const toggleButtons = document.querySelectorAll('[data-toggle]');
toggleButtons.forEach(item => {
    item.addEventListener('click', function () {
        const dataToggleContent = document.querySelector(item.dataset.toggle);
        dataToggleContent.classList.toggle('__active')
        item.classList.toggle('__active')
    });
});

// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================

// const wrapper = document.querySelector(".input-t-wrapper"),
//       textInput = document.querySelector(".input-t");
        
// textInput.addEventListener("keyup", event => {
//   wrapper.setAttribute("data-text", event.target.value);
// });

// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================

// search

// const input = document.querySelector('.search__block-input');
// const text = Array.from(document.querySelectorAll('.search-menu__category-item'));
// console.clear();

// let data = text.map(item => {
// 	return {
// 		id: item, copy: item.innerText.toLowerCase()
// 	}
// })

// input.addEventListener('keyup', () => {
// 	data.filter(item => {
// 		if(!item.copy.includes(input.value.toLowerCase())) {
// 			item.id.style.display = 'none';
// 		} else {
// 			item.id.style.display = 'inherit'
// 		}
// 	})
// })

// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================

// var input = document.querySelector('.search__block-inputh');
// var items = document.querySelector('.search-menu__category-list').getElementsByTagName('li');

// input.addEventListener('keyup', function(ev) {
//   var text = ev.target.value;
//   var pat = new RegExp(text, 'i');
//   for (var i=0; i < items.length; i++) {
//     var item = items[i];
//     if (pat.test(item.innerText)) {
//       item.classList.remove("hidden");
//     }
//     else {console.log(item);
//       item.classList.add("hidden");
//     }
//   }
// });

// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================

// ripple effect 

// function createRipple(event) {
//     const button = event.currentTarget;
  
//     const circle = document.createElement("span");
//     const diameter = Math.max(button.clientWidth, button.clientHeight);
//     const radius = diameter / 2;
  
//     circle.style.width = circle.style.height = `${diameter}px`;
//     circle.style.left = `${event.clientX - button.offsetLeft - radius}px`;
//     circle.style.top = `${event.clientY - button.offsetTop - radius}px`;
//     circle.classList.add("__ripple");
  
//     const ripple = button.getElementsByClassName("__ripple")[0];
  
//     if (ripple) {
//       ripple.remove();
//     }
  
//     button.appendChild(circle);
//   }
  
//   const buttons = document.querySelectorAll(".ripple-element");
//   for (const button of buttons) {
//     button.addEventListener("click", createRipple);
//   }

// ===================================================================================================================================================================================================================================================================================================================================================================================================================================
// ===================================================================================================================================================================================================================================================================================================================================================================================================================================

// lazy load

// var lazyImages = [].slice.call(document.querySelectorAll(".lazy-image.lazy"));
// let lazyImageObserver = new IntersectionObserver(function(entries, observer) {
//     entries.forEach(function(entry) {
//         if (entry.isIntersecting) {
//             let lazyImage = entry.target;
//             lazyImage.src = lazyImage.dataset.src;
//             lazyImage.classList.remove("lazy");
//             lazyImageObserver.unobserve(lazyImage);
//         }
//     });
// });
// lazyImages.forEach(function(lazyImage) {
//     lazyImageObserver.observe(lazyImage);
// });